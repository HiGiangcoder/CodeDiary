<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../unet/ rel=prev><link href=../../../Python/Numpy_1/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.7"><title>UNet (Final Project 2) - My Documentation</title><link rel=stylesheet href=../../../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Merriweather";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../../../assets/extra.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script> <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#1-prepare-data class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title="My Documentation" class="md-header__button md-logo" aria-label="My Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> My Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> UNet (Final Project 2) </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../home/ class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../lenet/lenet5/ class=md-tabs__link> Kiến thức lập trình </a> </li> <li class=md-tabs__item> <a href=../../../../Subject/XSTK/Exercise2/homework/ class=md-tabs__link> Môn học </a> </li> <li class=md-tabs__item> <a href=../../../../Problem/general/ class=md-tabs__link> CP-Problem </a> </li> <li class=md-tabs__item> <a href=../../../../other/other/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title="My Documentation" class="md-nav__button md-logo" aria-label="My Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> My Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=../../../../home/ class="md-nav__link "> <span class=md-ellipsis> Home </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../home/about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Kiến thức lập trình </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kiến thức lập trình </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1 checked> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> Các kiến trúc, mô hình AI và các kĩ thuật </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=true> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Các kiến trúc, mô hình AI và các kĩ thuật </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1_1> <label class=md-nav__link for=__nav_2_1_1 id=__nav_2_1_1_label tabindex=0> <span class=md-ellipsis> Lenet-5 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1_1> <span class="md-nav__icon md-icon"></span> Lenet-5 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lenet/lenet5/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../lenet/lenetpart1/ class=md-nav__link> <span class=md-ellipsis> Tutorial part 1 </span> </a> </li> <li class=md-nav__item> <a href=../../lenet/lenetpart2/ class=md-nav__link> <span class=md-ellipsis> Tutorial part 2 </span> </a> </li> <li class=md-nav__item> <a href=../../lenet/Lenet5_MNIST/ class=md-nav__link> <span class=md-ellipsis> Lenet-5 (Final Project 1) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1_2 checked> <label class=md-nav__link for=__nav_2_1_2 id=__nav_2_1_2_label tabindex=0> <span class=md-ellipsis> UNet </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_1_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_1_2> <span class="md-nav__icon md-icon"></span> UNet </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../unet/ class=md-nav__link> <span class=md-ellipsis> Unet tutorial </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> UNet (Final Project 2) </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> UNet (Final Project 2) </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#try-converting-images-and-masks-to-their-true-channel-and-check-number-of-channels-of-images-and-masks class=md-nav__link> <span class=md-ellipsis> Try converting images and masks to their true channel and check number of channels of images and masks </span> </a> </li> <li class=md-nav__item> <a href=#check-the-shape-of-images-and-masks class=md-nav__link> <span class=md-ellipsis> Check the shape of images and masks </span> </a> </li> <li class=md-nav__item> <a href=#show-examples-of-data class=md-nav__link> <span class=md-ellipsis> Show examples of data </span> </a> <nav class=md-nav aria-label="Show examples of data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bai-tap-1-plot-anh-tu-dataset-ra-oi-tuong-can-load-la-1-cap-mau-du-lieu-moi-cap-bao-gom-1-image-va-1-mask class=md-nav__link> <span class=md-ellipsis> Bài tập 1: Plot ảnh từ dataset ra, đối tượng cần load là 1 cặp mẫu dữ liệu, mỗi cặp bao gồm 1 image và 1 mask </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#split-data-into-three-sets class=md-nav__link> <span class=md-ellipsis> Split data into three sets </span> </a> </li> <li class=md-nav__item> <a href=#create-kvasir-dataset class=md-nav__link> <span class=md-ellipsis> Create Kvasir Dataset </span> </a> </li> <li class=md-nav__item> <a href=#calculate-mean-and-std-of-the-dataset class=md-nav__link> <span class=md-ellipsis> Calculate mean and std of the dataset </span> </a> </li> <li class=md-nav__item> <a href=#data-transform-and-augmentation class=md-nav__link> <span class=md-ellipsis> Data transform and augmentation </span> </a> <nav class=md-nav aria-label="Data transform and augmentation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bai-tap-2-hoan-thien-cac-phep-bien-oi-du-lieu class=md-nav__link> <span class=md-ellipsis> Bài tập 2: Hoàn thiện các phép biến đổi dữ liệu </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-dataset class=md-nav__link> <span class=md-ellipsis> Create dataset </span> </a> </li> <li class=md-nav__item> <a href=#make-dataloader class=md-nav__link> <span class=md-ellipsis> Make dataloader </span> </a> </li> <li class=md-nav__item> <a href=#show-batch class=md-nav__link> <span class=md-ellipsis> Show batch </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../essential.md class=md-nav__link> <span class=md-ellipsis> Các kiến thức cần thiết </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/Numpy_1/ class=md-nav__link> <span class=md-ellipsis> Numpy 1 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/Numpy_2/ class=md-nav__link> <span class=md-ellipsis> Numpy 2 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/Pandas/ class=md-nav__link> <span class=md-ellipsis> Pandas </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/Python_Pandas_exercise1/ class=md-nav__link> <span class=md-ellipsis> Pandas exercise 1 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/Pandas2/ class=md-nav__link> <span class=md-ellipsis> Pandas 2 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/Python_Pandas_exercise2/ class=md-nav__link> <span class=md-ellipsis> Pandas exercise 2 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/Pandas_Join_Combine/ class=md-nav__link> <span class=md-ellipsis> Pandas Join Combine </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> PyTorch </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> PyTorch </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Pytorch/00_pytorch_fundamentals/ class=md-nav__link> <span class=md-ellipsis> 0 Pytorch Fundamentals (ipynb) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/00_pytorch_and_deep_learning_fundamentals.pdf class=md-nav__link> <span class=md-ellipsis> 0 Deep learning fundamentals (pdf) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/01_pytorch_workflow/ class=md-nav__link> <span class=md-ellipsis> 1 Pytorch workflow (ipynb) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/01_pytorch_workflow.pdf class=md-nav__link> <span class=md-ellipsis> 1 Pytorch workflow (pdf) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/02_pytorch_classification/ class=md-nav__link> <span class=md-ellipsis> 2 classification (ipynb) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/03_pytorch_computer_vision/ class=md-nav__link> <span class=md-ellipsis> 3 Computer vision (ipynb) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/03_pytorch_computer_vision.pdf class=md-nav__link> <span class=md-ellipsis> 3 Compupter vision (pdf) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/04_pytorch_custom_datasets/ class=md-nav__link> <span class=md-ellipsis> 4 Custom datasets (pdf) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/05_pytorch_going_modular.pdf class=md-nav__link> <span class=md-ellipsis> 5 Going moduler (pdf) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/06_pytorch_transfer_learning/ class=md-nav__link> <span class=md-ellipsis> 6 Transfer learning (ipynb) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/06_pytorch_transfer_learning.pdf class=md-nav__link> <span class=md-ellipsis> 6 Transfer learning (pdf) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/07_pytorch_experiment_tracking/ class=md-nav__link> <span class=md-ellipsis> 7 Experiment tracking (ipynb) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/07_pytorch_experiment_tracking.pdf class=md-nav__link> <span class=md-ellipsis> 7 Experiment tracking (pdf) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/08_pytorch_paper_replicating/ class=md-nav__link> <span class=md-ellipsis> 8 Paper replicating (ipynb) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/08_pytorch_paper_replicating.pdf class=md-nav__link> <span class=md-ellipsis> 8 Paper replicating (pdf) </span> </a> </li> <li class=md-nav__item> <a href=../../../Pytorch/09_pytorch_model_deployment.pdf class=md-nav__link> <span class=md-ellipsis> 9 Model deployment(pdf) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> Tensorflow </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Tensorflow </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Tensorflow/00_tensorflow_fundamentals/ class=md-nav__link> <span class=md-ellipsis> 0 Tensorflow fundamentals </span> </a> </li> <li class=md-nav__item> <a href=../../../Tensorflow/01_neural_network_regression_in_tensorflow/ class=md-nav__link> <span class=md-ellipsis> 1 Neural network regression </span> </a> </li> <li class=md-nav__item> <a href=../../../Tensorflow/02_neural_network_classification_in_tensorflow/ class=md-nav__link> <span class=md-ellipsis> 2 Neural network classification </span> </a> </li> <li class=md-nav__item> <a href=../../../Tensorflow/04_transfer_learning_in_tensorflow_part_1_feature_extraction/ class=md-nav__link> <span class=md-ellipsis> 4 Transfer learning </span> </a> </li> <li class=md-nav__item> <a href=../../../Tensorflow/10_time_series_forecasting_in_tensorflow/ class=md-nav__link> <span class=md-ellipsis> 10 Time series forecasting </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../OOP_Practice/ class=md-nav__link> <span class=md-ellipsis> OOP Practice </span> </a> </li> <li class=md-nav__item> <a href=../../../Visualization/ class=md-nav__link> <span class=md-ellipsis> Visualization </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Môn học </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Môn học </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Xác suất thống kê </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Xác suất thống kê </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Subject/XSTK/Exercise2/homework/ class=md-nav__link> <span class=md-ellipsis> Bài tập về nhà buổi 2 </span> </a> </li> <li class=md-nav__item> <a href=../../../../Subject/XSTK/Exercise3/homework/ class=md-nav__link> <span class=md-ellipsis> Bài tập về nhà buổi 3 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> CP-Problem </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> CP-Problem </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/general/ class=md-nav__link> <span class=md-ellipsis> General </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> COCI 2006 2007 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> COCI 2006 2007 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_2> <label class=md-nav__link for=__nav_4_2_2 id=__nav_4_2_2_label tabindex=0> <span class=md-ellipsis> Contest 1 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_2> <span class="md-nav__icon md-icon"></span> Contest 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest1/P1_MODULO/ class=md-nav__link> <span class=md-ellipsis> MODULO </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest1/P2_HERMAN/ class=md-nav__link> <span class=md-ellipsis> HERMAN </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest1/P3_OKVIRI/ class=md-nav__link> <span class=md-ellipsis> OKVIRI </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest1/P4_SLIKAR/ class=md-nav__link> <span class=md-ellipsis> SLIKAR </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest1/P5_BOND/ class=md-nav__link> <span class=md-ellipsis> BOND </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest1/P6_DEBUG/ class=md-nav__link> <span class=md-ellipsis> DEBUG </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_3> <label class=md-nav__link for=__nav_4_2_3 id=__nav_4_2_3_label tabindex=0> <span class=md-ellipsis> Contest 2 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_3> <span class="md-nav__icon md-icon"></span> Contest 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest2/P1_R2/ class=md-nav__link> <span class=md-ellipsis> R2 </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest2/P2_ABC/ class=md-nav__link> <span class=md-ellipsis> ABC </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest2/P3_KOLONE/ class=md-nav__link> <span class=md-ellipsis> KOLONE </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest2/P4_SJECISTA/ class=md-nav__link> <span class=md-ellipsis> SJECISTA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest2/P5_STOL/ class=md-nav__link> <span class=md-ellipsis> STOL </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest2/P6_STRAZA/ class=md-nav__link> <span class=md-ellipsis> STRAZA </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_4> <label class=md-nav__link for=__nav_4_2_4 id=__nav_4_2_4_label tabindex=0> <span class=md-ellipsis> Contest 3 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_4> <span class="md-nav__icon md-icon"></span> Contest 3 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest3/P1_PATULJCI/ class=md-nav__link> <span class=md-ellipsis> PATULJCI </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest3/P2_NPUZZLE/ class=md-nav__link> <span class=md-ellipsis> NPUZZLE </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest3/P3_TROJKE/ class=md-nav__link> <span class=md-ellipsis> TROJKE </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest3/P4_TENKICI/ class=md-nav__link> <span class=md-ellipsis> TENKICI </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest3/P5_BICIKLI/ class=md-nav__link> <span class=md-ellipsis> BICIKLI </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest3/P6_LISTA/ class=md-nav__link> <span class=md-ellipsis> LISTA </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_5> <label class=md-nav__link for=__nav_4_2_5 id=__nav_4_2_5_label tabindex=0> <span class=md-ellipsis> Contest 4 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_5> <span class="md-nav__icon md-icon"></span> Contest 4 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest4/P1_Sibice/ class=md-nav__link> <span class=md-ellipsis> SIBICE </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest4/P2_Skener/ class=md-nav__link> <span class=md-ellipsis> SKENER </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest4/P3_Prsteni/ class=md-nav__link> <span class=md-ellipsis> PRSTENI </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest4/P4_Zbrka/ class=md-nav__link> <span class=md-ellipsis> ZBRKA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest4/P5_Jogurt/ class=md-nav__link> <span class=md-ellipsis> JOGURT </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest4/P6_Ispiti/ class=md-nav__link> <span class=md-ellipsis> ISPITI </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_6> <label class=md-nav__link for=__nav_4_2_6 id=__nav_4_2_6_label tabindex=0> <span class=md-ellipsis> Contest 5 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_6> <span class="md-nav__icon md-icon"></span> Contest 5 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest5/P1_Trik/ class=md-nav__link> <span class=md-ellipsis> TRIK </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest5/P2_Natrij/ class=md-nav__link> <span class=md-ellipsis> NATRIJ </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest5/P3_Tenis/ class=md-nav__link> <span class=md-ellipsis> TENIS </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest5/P4_Liga/ class=md-nav__link> <span class=md-ellipsis> LIGA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest5/P5_Ivana/ class=md-nav__link> <span class=md-ellipsis> IVANA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest5/P6_Dvaput/ class=md-nav__link> <span class=md-ellipsis> DVAPUT </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_7> <label class=md-nav__link for=__nav_4_2_7 id=__nav_4_2_7_label tabindex=0> <span class=md-ellipsis> Contest 6 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_7> <span class="md-nav__icon md-icon"></span> Contest 6 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest6/P1_PRASE/ class=md-nav__link> <span class=md-ellipsis> PRASE </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest6/P2_MAGIJA/ class=md-nav__link> <span class=md-ellipsis> MAGIJA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest6/P3_MARATON/ class=md-nav__link> <span class=md-ellipsis> MARATON </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest6/P4_KAMEN/ class=md-nav__link> <span class=md-ellipsis> KAMEN </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest6/P5_V/ class=md-nav__link> <span class=md-ellipsis> V </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Contest6/P6_PROSTOR/ class=md-nav__link> <span class=md-ellipsis> PROSTOR </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_8> <label class=md-nav__link for=__nav_4_2_8 id=__nav_4_2_8_label tabindex=0> <span class=md-ellipsis> Regional </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_8> <span class="md-nav__icon md-icon"></span> Regional </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Regional/P1_BARD/ class=md-nav__link> <span class=md-ellipsis> BARD </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Regional/P2_TETRIS/ class=md-nav__link> <span class=md-ellipsis> TETRIS </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Regional/P4_CIRCLE/ class=md-nav__link> <span class=md-ellipsis> CIRCLE </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_9> <label class=md-nav__link for=__nav_4_2_9 id=__nav_4_2_9_label tabindex=0> <span class=md-ellipsis> Croatian Olympiad </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_9> <span class="md-nav__icon md-icon"></span> Croatian Olympiad </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Olympiad/P1_PATRIK/ class=md-nav__link> <span class=md-ellipsis> PATRIK </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Olympiad/P2_POLICIJA/ class=md-nav__link> <span class=md-ellipsis> POLICIJA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0607/Olympiad/P3_SABOR/ class=md-nav__link> <span class=md-ellipsis> SABOR </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> COCI 2007 2008 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> COCI 2007 2008 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3_2> <label class=md-nav__link for=__nav_4_3_2 id=__nav_4_3_2_label tabindex=0> <span class=md-ellipsis> Contest 1 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3_2> <span class="md-nav__icon md-icon"></span> Contest 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest1/P1_CETVRTA/ class=md-nav__link> <span class=md-ellipsis> CETVRTA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest1/P2_PEG/ class=md-nav__link> <span class=md-ellipsis> PEG </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest1/P3_PRINOVA/ class=md-nav__link> <span class=md-ellipsis> PRINOVA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest1/P4_ZAPIS/ class=md-nav__link> <span class=md-ellipsis> ZAPIS </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest1/P5_SREDNJI/ class=md-nav__link> <span class=md-ellipsis> SREDNJI </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest1/P6_STAZA/ class=md-nav__link> <span class=md-ellipsis> STAZA </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3_3> <label class=md-nav__link for=__nav_4_3_3 id=__nav_4_3_3_label tabindex=0> <span class=md-ellipsis> Contest 4 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3_3> <span class="md-nav__icon md-icon"></span> Contest 4 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest4/P1_CIRCLE/ class=md-nav__link> <span class=md-ellipsis> CIRCLE </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest4/P2_VECI/ class=md-nav__link> <span class=md-ellipsis> VECI </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest4/P3_LEKTIRA/ class=md-nav__link> <span class=md-ellipsis> LEKTIRA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest4/P4_MUZICARI/ class=md-nav__link> <span class=md-ellipsis> MUZICARI </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest4/P5_POKLON/ class=md-nav__link> <span class=md-ellipsis> POKLON </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest4/P6_KOCKE/ class=md-nav__link> <span class=md-ellipsis> KOCKE </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3_4> <label class=md-nav__link for=__nav_4_3_4 id=__nav_4_3_4_label tabindex=0> <span class=md-ellipsis> Contest 6 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3_4> <span class="md-nav__icon md-icon"></span> Contest 6 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest6/P1_PARKING/ class=md-nav__link> <span class=md-ellipsis> PARKING </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest6/P2_SEMAFORI/ class=md-nav__link> <span class=md-ellipsis> SEMAFORI </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest6/P3_GRANICA/ class=md-nav__link> <span class=md-ellipsis> GRANICA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest6/P4_GEORGE/ class=md-nav__link> <span class=md-ellipsis> GEORGE </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest6/P5_PRINCEZA/ class=md-nav__link> <span class=md-ellipsis> PRINCEZA </span> </a> </li> <li class=md-nav__item> <a href=../../../../Problem/coci0708/Contest6/P6_CESTARINE/ class=md-nav__link> <span class=md-ellipsis> CESTARINE </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../other/other/ class=md-nav__link> <span class=md-ellipsis> Other </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#try-converting-images-and-masks-to-their-true-channel-and-check-number-of-channels-of-images-and-masks class=md-nav__link> <span class=md-ellipsis> Try converting images and masks to their true channel and check number of channels of images and masks </span> </a> </li> <li class=md-nav__item> <a href=#check-the-shape-of-images-and-masks class=md-nav__link> <span class=md-ellipsis> Check the shape of images and masks </span> </a> </li> <li class=md-nav__item> <a href=#show-examples-of-data class=md-nav__link> <span class=md-ellipsis> Show examples of data </span> </a> <nav class=md-nav aria-label="Show examples of data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bai-tap-1-plot-anh-tu-dataset-ra-oi-tuong-can-load-la-1-cap-mau-du-lieu-moi-cap-bao-gom-1-image-va-1-mask class=md-nav__link> <span class=md-ellipsis> Bài tập 1: Plot ảnh từ dataset ra, đối tượng cần load là 1 cặp mẫu dữ liệu, mỗi cặp bao gồm 1 image và 1 mask </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#split-data-into-three-sets class=md-nav__link> <span class=md-ellipsis> Split data into three sets </span> </a> </li> <li class=md-nav__item> <a href=#create-kvasir-dataset class=md-nav__link> <span class=md-ellipsis> Create Kvasir Dataset </span> </a> </li> <li class=md-nav__item> <a href=#calculate-mean-and-std-of-the-dataset class=md-nav__link> <span class=md-ellipsis> Calculate mean and std of the dataset </span> </a> </li> <li class=md-nav__item> <a href=#data-transform-and-augmentation class=md-nav__link> <span class=md-ellipsis> Data transform and augmentation </span> </a> <nav class=md-nav aria-label="Data transform and augmentation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bai-tap-2-hoan-thien-cac-phep-bien-oi-du-lieu class=md-nav__link> <span class=md-ellipsis> Bài tập 2: Hoàn thiện các phép biến đổi dữ liệu </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-dataset class=md-nav__link> <span class=md-ellipsis> Create dataset </span> </a> </li> <li class=md-nav__item> <a href=#make-dataloader class=md-nav__link> <span class=md-ellipsis> Make dataloader </span> </a> </li> <li class=md-nav__item> <a href=#show-batch class=md-nav__link> <span class=md-ellipsis> Show batch </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>opendatasets</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>od</span>

<span class=n>data_path</span> <span class=o>=</span> <span class=s1>&#39;https://www.kaggle.com/datasets/abdallahwagih/kvasir-dataset-for-classification-and-segmentation&#39;</span>
<span class=n>od</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>data_path</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>Skipping, found downloaded files in &quot;./kvasir-dataset-for-classification-and-segmentation&quot; (use force=True to force download)
</code></pre></div> <h1 id=1-prepare-data>1. Prepare data</h1> <div class=highlight><pre><span></span><code><span class=c1># Read image and mask paths</span>
<span class=n>image_paths</span> <span class=o>=</span> <span class=p>[]</span>
<span class=n>mask_paths</span> <span class=o>=</span> <span class=p>[]</span>
<span class=kn>import</span><span class=w> </span><span class=nn>os</span>

<span class=n>images_root</span> <span class=o>=</span> <span class=s1>&#39;./kvasir-dataset-for-classification-and-segmentation/kvasir-seg/Kvasir-SEG/images&#39;</span>
<span class=n>masks_root</span> <span class=o>=</span> <span class=s1>&#39;./kvasir-dataset-for-classification-and-segmentation/kvasir-seg/Kvasir-SEG/masks&#39;</span>

<span class=k>for</span> <span class=n>image</span><span class=p>,</span> <span class=n>mask</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>images_root</span><span class=p>),</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>masks_root</span><span class=p>)):</span>
    <span class=n>image_paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>images_root</span><span class=p>,</span> <span class=n>image</span><span class=p>))</span>
    <span class=n>mask_paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>masks_root</span><span class=p>,</span> <span class=n>mask</span><span class=p>))</span>
</code></pre></div> <h3 id=try-converting-images-and-masks-to-their-true-channel-and-check-number-of-channels-of-images-and-masks>Try converting images and masks to their true channel and check number of channels of images and masks</h3> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>PIL</span><span class=w> </span><span class=kn>import</span> <span class=n>Image</span>

<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Image: &#39;</span><span class=p>,</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>image_paths</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>getbands</span><span class=p>())</span>
<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Mask: &#39;</span><span class=p>,</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>mask_paths</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;L&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>getbands</span><span class=p>())</span>
</code></pre></div> <div class=highlight><pre><span></span><code>Image:  (&#39;R&#39;, &#39;G&#39;, &#39;B&#39;)
Mask:  (&#39;L&#39;,)
</code></pre></div> <h3 id=check-the-shape-of-images-and-masks>Check the shape of images and masks</h3> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>

<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Images: &#39;</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>image_paths</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Masks: &#39;</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>mask_paths</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;L&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>Images:  (529, 622, 3)
Masks:  (529, 622)
</code></pre></div> <h3 id=show-examples-of-data>Show examples of data</h3> <h4 id=bai-tap-1-plot-anh-tu-dataset-ra-oi-tuong-can-load-la-1-cap-mau-du-lieu-moi-cap-bao-gom-1-image-va-1-mask>Bài tập 1: Plot ảnh từ dataset ra, đối tượng cần load là 1 cặp mẫu dữ liệu, mỗi cặp bao gồm 1 image và 1 mask</h4> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>matplotlib.pyplot</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>plt</span>
<span class=k>def</span><span class=w> </span><span class=nf>Visualize_Data</span><span class=p>():</span>
    <span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>28</span><span class=p>,</span> <span class=mi>16</span><span class=p>))</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>2</span><span class=p>):</span>
        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>7</span><span class=p>):</span>
            <span class=n>num</span> <span class=o>=</span> <span class=n>i</span> <span class=o>//</span> <span class=mi>2</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=n>j</span>
            <span class=n>image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>image_paths</span><span class=p>[</span><span class=n>num</span><span class=p>])</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>)</span>
            <span class=n>image</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>resize</span><span class=p>((</span><span class=mi>224</span><span class=p>,</span> <span class=mi>224</span><span class=p>))</span>
            <span class=n>mask</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>mask_paths</span><span class=p>[</span><span class=n>num</span><span class=p>])</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;L&#39;</span><span class=p>)</span>
            <span class=n>mask</span> <span class=o>=</span> <span class=n>mask</span><span class=o>.</span><span class=n>resize</span><span class=p>((</span><span class=mi>224</span><span class=p>,</span> <span class=mi>224</span><span class=p>))</span>
            <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>]</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
            <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>]</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s1>&#39;off&#39;</span><span class=p>)</span>

            <span class=n>axes</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>j</span><span class=p>]</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>mask</span><span class=p>)</span>
            <span class=n>axes</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>j</span><span class=p>]</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s1>&#39;off&#39;</span><span class=p>)</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>subplots_adjust</span><span class=p>(</span><span class=n>wspace</span><span class=o>=</span><span class=mf>0.01</span><span class=p>,</span> <span class=n>hspace</span><span class=o>=</span><span class=mf>0.01</span><span class=p>)</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>


<span class=n>Visualize_Data</span><span class=p>()</span>
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_8_0.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_8_0.png></a></p> <h3 id=split-data-into-three-sets>Split data into three sets</h3> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>sklearn.model_selection</span><span class=w> </span><span class=kn>import</span> <span class=n>train_test_split</span>
<span class=c1># seed = 0</span>
<span class=n>val_size</span> <span class=o>=</span> <span class=mf>0.2</span>
<span class=n>test_size</span> <span class=o>=</span> <span class=mf>0.25</span>
<span class=n>is_shuffle</span> <span class=o>=</span> <span class=kc>True</span>

<span class=n>X_train</span><span class=p>,</span> <span class=n>X_val</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>y_val</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span>
    <span class=n>image_paths</span><span class=p>,</span>
    <span class=n>mask_paths</span><span class=p>,</span>
    <span class=n>test_size</span><span class=o>=</span><span class=n>val_size</span><span class=p>,</span>
    <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span>
    <span class=n>shuffle</span><span class=o>=</span><span class=n>is_shuffle</span>
<span class=p>)</span>

<span class=n>X_train</span><span class=p>,</span> <span class=n>X_test</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span>
    <span class=n>X_train</span><span class=p>,</span>
    <span class=n>y_train</span><span class=p>,</span>
    <span class=n>test_size</span><span class=o>=</span><span class=n>test_size</span><span class=p>,</span>
    <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span>
    <span class=n>shuffle</span><span class=o>=</span><span class=n>is_shuffle</span>
<span class=p>)</span>

<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Train: &#39;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>X_train</span><span class=p>))</span>
<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Val: &#39;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>X_val</span><span class=p>))</span>
<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Test: &#39;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>X_test</span><span class=p>))</span>
</code></pre></div> <div class=highlight><pre><span></span><code>Train:  600
Val:  200
Test:  200
</code></pre></div> <h3 id=create-kvasir-dataset>Create Kvasir Dataset</h3> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>torch.utils.data</span><span class=w> </span><span class=kn>import</span> <span class=n>Dataset</span><span class=p>,</span> <span class=n>DataLoader</span>

<span class=k>class</span><span class=w> </span><span class=nc>KvasirDataset</span><span class=p>(</span><span class=n>Dataset</span><span class=p>):</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>image_paths</span><span class=p>,</span> <span class=n>mask_paths</span><span class=p>,</span> <span class=n>transform</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>image_paths</span> <span class=o>=</span> <span class=n>image_paths</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>mask_paths</span> <span class=o>=</span> <span class=n>mask_paths</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>transform</span> <span class=o>=</span> <span class=n>transform</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>image_paths</span><span class=p>)</span>

    <span class=c1># Load image and mask</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__getitem__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>idx</span><span class=p>):</span>
        <span class=n>image_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>image_paths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
        <span class=n>mask_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>mask_paths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
        <span class=n>image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>image_path</span><span class=p>)</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>)</span>
        <span class=n>mask</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>mask_path</span><span class=p>)</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;L&#39;</span><span class=p>)</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>transform</span><span class=p>:</span>
            <span class=n>image</span><span class=p>,</span> <span class=n>mask</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>image</span><span class=p>,</span> <span class=n>mask</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>image</span><span class=p>,</span> <span class=n>mask</span>
</code></pre></div> <h3 id=calculate-mean-and-std-of-the-dataset>Calculate mean and std of the dataset</h3> <div class=highlight><pre><span></span><code><span class=c1># Create non transform dataset</span>
<span class=n>full_data</span> <span class=o>=</span> <span class=n>KvasirDataset</span><span class=p>(</span><span class=n>image_paths</span><span class=p>,</span> <span class=n>mask_paths</span><span class=p>)</span>
<span class=n>img_data</span> <span class=o>=</span> <span class=p>[]</span>
<span class=k>for</span> <span class=n>img</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>full_data</span><span class=p>:</span>
    <span class=n>img_array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>resize</span><span class=p>((</span><span class=mi>224</span><span class=p>,</span> <span class=mi>224</span><span class=p>)))</span> <span class=o>/</span> <span class=mf>255.0</span>
    <span class=n>img_data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>img_array</span><span class=p>)</span>

<span class=n>img_data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img_data</span><span class=p>)</span>

<span class=c1># Calculate mean and std</span>
<span class=n>mean</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>img_data</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
<span class=n>std</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=n>img_data</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>

<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Mean: &#39;</span><span class=p>,</span> <span class=n>mean</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Std: &#39;</span><span class=p>,</span> <span class=n>std</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>Mean:  [0.55714883 0.32170294 0.23581956]
Std:  [0.31774015 0.22082197 0.18651856]
</code></pre></div> <h3 id=data-transform-and-augmentation>Data transform and augmentation</h3> <h4 id=bai-tap-2-hoan-thien-cac-phep-bien-oi-du-lieu>Bài tập 2: Hoàn thiện các phép biến đổi dữ liệu</h4> <p>Trong bài tập này, bạn sẽ hoàn thiện các phép biến đổi (transforms) cho ảnh và mask. Các phép biến đổi này sẽ giúp chuẩn bị dữ liệu trước khi đưa vào mô hình học sâu. Gợi ý: dùng các hàm trong "transforms"</p> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>torchvision.transforms</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>transforms</span>
<span class=kn>import</span><span class=w> </span><span class=nn>torch</span>

<span class=c1># Define a class transform for image and mask</span>
<span class=k>class</span><span class=w> </span><span class=nc>CustomTransform</span><span class=p>:</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>image_transform</span><span class=p>,</span> <span class=n>mask_transform</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>image_transform</span> <span class=o>=</span> <span class=n>image_transform</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>mask_transform</span> <span class=o>=</span> <span class=n>mask_transform</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>image</span><span class=p>,</span> <span class=n>mask</span><span class=p>):</span>
        <span class=n>seed</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>initial_seed</span><span class=p>()</span>
        <span class=n>torch</span><span class=o>.</span><span class=n>manual_seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
        <span class=n>image</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>image_transform</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>

        <span class=n>torch</span><span class=o>.</span><span class=n>manual_seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
        <span class=n>mask</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>mask_transform</span><span class=p>(</span><span class=n>mask</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>image</span><span class=p>,</span> <span class=n>mask</span>

<span class=c1># Train Image transforms</span>
<span class=n>train_image_transforms</span> <span class=o>=</span> <span class=n>transforms</span><span class=o>.</span><span class=n>Compose</span><span class=p>([</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>Resize</span><span class=p>((</span><span class=mi>224</span><span class=p>,</span> <span class=mi>224</span><span class=p>)),</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>ToTensor</span><span class=p>(),</span>
    <span class=c1># TODO: Chuẩn hóa ảnh với giá trị mean và std, các giá trị mean và std dùng lại mean và std đã tính ở trên</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>Normalize</span><span class=p>(</span><span class=n>mean</span><span class=o>=</span><span class=p>[</span><span class=mf>0.55714883</span><span class=p>,</span> <span class=mf>0.32170294</span><span class=p>,</span> <span class=mf>0.23581956</span><span class=p>],</span> <span class=n>std</span><span class=o>=</span><span class=p>[</span><span class=mf>0.31774015</span><span class=p>,</span> <span class=mf>0.22082197</span><span class=p>,</span> <span class=mf>0.18651856</span><span class=p>])</span>
<span class=p>])</span>

<span class=c1># Train Mask Transforms</span>
<span class=n>train_mask_transforms</span> <span class=o>=</span> <span class=n>transforms</span><span class=o>.</span><span class=n>Compose</span><span class=p>([</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>Resize</span><span class=p>((</span><span class=mi>224</span><span class=p>,</span> <span class=mi>224</span><span class=p>)),</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>ToTensor</span><span class=p>(),</span>
    <span class=c1># TODO: Chuyển mask thành nhị phân, gồm các giá trị 0 và 1</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>Lambda</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span><span class=n>x</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>)</span><span class=o>.</span><span class=n>float</span><span class=p>())</span>
<span class=p>])</span>

<span class=c1># Val Image transforms</span>
<span class=n>val_image_transforms</span> <span class=o>=</span> <span class=n>transforms</span><span class=o>.</span><span class=n>Compose</span><span class=p>([</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>Resize</span><span class=p>((</span><span class=mi>224</span><span class=p>,</span> <span class=mi>224</span><span class=p>)),</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>ToTensor</span><span class=p>(),</span>
    <span class=c1># TODO: Chuẩn hóa ảnh với giá trị mean và std, các giá trị mean và std dùng lại mean và std đã tính ở trên</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>Normalize</span><span class=p>(</span><span class=n>mean</span><span class=o>=</span><span class=p>[</span><span class=mf>0.55714883</span><span class=p>,</span> <span class=mf>0.32170294</span><span class=p>,</span> <span class=mf>0.23581956</span><span class=p>],</span> <span class=n>std</span><span class=o>=</span><span class=p>[</span><span class=mf>0.31774015</span><span class=p>,</span> <span class=mf>0.22082197</span><span class=p>,</span> <span class=mf>0.18651856</span><span class=p>])</span>
<span class=p>])</span>

<span class=c1># Val Mask transforms</span>
<span class=n>val_mask_transforms</span> <span class=o>=</span> <span class=n>transforms</span><span class=o>.</span><span class=n>Compose</span><span class=p>([</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>Resize</span><span class=p>((</span><span class=mi>224</span><span class=p>,</span> <span class=mi>224</span><span class=p>)),</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>ToTensor</span><span class=p>(),</span>
    <span class=c1># TODO: Chuyển mask thành nhị phân, gồm các giá trị 0 và 1</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>Lambda</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span><span class=n>x</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>)</span><span class=o>.</span><span class=n>float</span><span class=p>())</span>
<span class=p>])</span>

<span class=c1># Transforms dictionary</span>
<span class=n>data_transforms</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;train&#39;</span><span class=p>:</span> <span class=n>CustomTransform</span><span class=p>(</span><span class=n>train_image_transforms</span><span class=p>,</span> <span class=n>train_mask_transforms</span><span class=p>),</span>
    <span class=s1>&#39;val&#39;</span><span class=p>:</span> <span class=n>CustomTransform</span><span class=p>(</span><span class=n>val_image_transforms</span><span class=p>,</span> <span class=n>val_mask_transforms</span><span class=p>),</span>
<span class=p>}</span>
</code></pre></div> <h3 id=create-dataset>Create dataset</h3> <div class=highlight><pre><span></span><code><span class=c1># Create datasets</span>
<span class=n>train_dataset</span> <span class=o>=</span> <span class=n>KvasirDataset</span><span class=p>(</span>
    <span class=n>X_train</span><span class=p>,</span>
    <span class=n>y_train</span><span class=p>,</span>
    <span class=n>transform</span><span class=o>=</span><span class=n>data_transforms</span><span class=p>[</span><span class=s1>&#39;train&#39;</span><span class=p>]</span>
<span class=p>)</span>

<span class=n>val_dataset</span> <span class=o>=</span> <span class=n>KvasirDataset</span><span class=p>(</span>
    <span class=n>X_val</span><span class=p>,</span>
    <span class=n>y_val</span><span class=p>,</span>
    <span class=n>transform</span><span class=o>=</span><span class=n>data_transforms</span><span class=p>[</span><span class=s1>&#39;val&#39;</span><span class=p>]</span>
<span class=p>)</span>

<span class=n>test_dataset</span> <span class=o>=</span> <span class=n>KvasirDataset</span><span class=p>(</span>
    <span class=n>X_test</span><span class=p>,</span>
    <span class=n>y_test</span><span class=p>,</span>
    <span class=n>transform</span><span class=o>=</span><span class=n>data_transforms</span><span class=p>[</span><span class=s1>&#39;val&#39;</span><span class=p>]</span>
<span class=p>)</span>
</code></pre></div> <h3 id=make-dataloader>Make dataloader</h3> <div class=highlight><pre><span></span><code><span class=c1># Create dataloaders</span>
<span class=n>train_batch_size</span> <span class=o>=</span> <span class=mi>8</span>
<span class=n>test_batch_size</span> <span class=o>=</span> <span class=mi>4</span>

<span class=n>train_loader</span> <span class=o>=</span> <span class=n>DataLoader</span><span class=p>(</span>
    <span class=n>train_dataset</span><span class=p>,</span>
    <span class=n>batch_size</span><span class=o>=</span><span class=n>train_batch_size</span><span class=p>,</span>
    <span class=n>shuffle</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>

<span class=n>val_loader</span> <span class=o>=</span> <span class=n>DataLoader</span><span class=p>(</span>
    <span class=n>val_dataset</span><span class=p>,</span>
    <span class=n>batch_size</span><span class=o>=</span><span class=n>test_batch_size</span><span class=p>,</span>
    <span class=n>shuffle</span><span class=o>=</span><span class=kc>False</span>
<span class=p>)</span>

<span class=n>test_loader</span> <span class=o>=</span> <span class=n>DataLoader</span><span class=p>(</span>
    <span class=n>test_dataset</span><span class=p>,</span>
    <span class=n>batch_size</span><span class=o>=</span><span class=n>test_batch_size</span><span class=p>,</span>
    <span class=n>shuffle</span><span class=o>=</span><span class=kc>False</span>
<span class=p>)</span>
</code></pre></div> <h3 id=show-batch>Show batch</h3> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>torchvision</span>

<span class=n>train_features</span><span class=p>,</span> <span class=n>train_labels</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=nb>iter</span><span class=p>(</span><span class=n>train_loader</span><span class=p>))</span>

<span class=c1># Use torchvision to display a grid of images</span>
<span class=k>def</span><span class=w> </span><span class=nf>show_batch</span><span class=p>(</span><span class=n>images</span><span class=p>,</span> <span class=n>masks</span><span class=p>):</span>
    <span class=n>grid_images</span> <span class=o>=</span> <span class=n>torchvision</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>make_grid</span><span class=p>(</span><span class=n>images</span><span class=p>,</span> <span class=n>nrow</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>normalize</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>grid_masks</span> <span class=o>=</span> <span class=n>torchvision</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>make_grid</span><span class=p>(</span><span class=n>masks</span><span class=p>,</span> <span class=n>nrow</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>normalize</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>))</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>transpose</span><span class=p>(</span><span class=n>grid_images</span><span class=p>,</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)),</span> <span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>))</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>transpose</span><span class=p>(</span><span class=n>grid_masks</span><span class=p>,</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)),</span> <span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Check the shape of the images and masks</span>
<span class=n>train_features</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>shape</span>
</code></pre></div> <div class=highlight><pre><span></span><code>torch.Size([3, 224, 224])
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Display a batch of images and masks</span>
<span class=n>show_batch</span><span class=p>(</span><span class=n>train_features</span><span class=p>,</span> <span class=n>train_labels</span><span class=p>)</span>
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_24_0.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_24_0.png></a></p> <p><a class=glightbox href=../UNet_files/UNet_24_1.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_24_1.png></a></p> <div class=highlight><pre><span></span><code><span class=c1># Check device availability</span>
<span class=kn>import</span><span class=w> </span><span class=nn>torch</span>
<span class=n>device</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>device</span><span class=p>(</span><span class=s1>&#39;cuda&#39;</span> <span class=k>if</span> <span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>is_available</span><span class=p>()</span> <span class=k>else</span> <span class=s1>&#39;cpu&#39;</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>cuda
</code></pre></div> <h1 id=2-model>2. Model</h1> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>torch</span>
<span class=kn>import</span><span class=w> </span><span class=nn>torch.nn</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>nn</span>
<span class=kn>import</span><span class=w> </span><span class=nn>torch.nn.functional</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>F</span>
<span class=kn>import</span><span class=w> </span><span class=nn>torchvision</span>
<span class=kn>from</span><span class=w> </span><span class=nn>torchvision</span><span class=w> </span><span class=kn>import</span> <span class=n>models</span>
<span class=kn>import</span><span class=w> </span><span class=nn>torch.optim</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>optim</span>
<span class=kn>from</span><span class=w> </span><span class=nn>time</span><span class=w> </span><span class=kn>import</span> <span class=n>time</span>

<span class=kn>from</span><span class=w> </span><span class=nn>matplotlib</span><span class=w> </span><span class=kn>import</span> <span class=n>rcParams</span>
<span class=n>rcParams</span><span class=p>[</span><span class=s1>&#39;figure.figsize&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mi>15</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>
</code></pre></div> <h4 id=bai-tap-3-hoan-thanh-cac-oan-code-sau-theo-goi-y>Bài tập 3: Hoàn thành các đoạn code sau theo gợi ý</h4> <div class=highlight><pre><span></span><code><span class=c1># Define the convolutional block</span>
<span class=k>def</span><span class=w> </span><span class=nf>conv3x3</span><span class=p>(</span><span class=n>in_</span><span class=p>,</span> <span class=n>out</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=n>in_</span><span class=p>,</span> <span class=n>out</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>padding</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

<span class=c1># Define the ConvRelu</span>
<span class=k>class</span><span class=w> </span><span class=nc>ConvRelu</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>in_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>out</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>conv</span> <span class=o>=</span> <span class=n>conv3x3</span><span class=p>(</span><span class=n>in_</span><span class=p>,</span> <span class=n>out</span><span class=p>)</span> <span class=c1># TODO: Tạo một lớp convolution sử dụng hàm conv3x3 ở trên</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>batchnorm</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>BatchNorm2d</span><span class=p>(</span><span class=n>out</span><span class=p>)</span> <span class=c1># thays hay nen them vo</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>relu</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(</span><span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=c1># TODO: Tạo một lớp ReLU activation với inplace=True</span>
    <span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
        <span class=n>x</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conv</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=c1># TODO: Áp dụng lớp convolution lên input x</span>
        <span class=n>x</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>batchnorm</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=c1># thay hay nen them vo</span>
        <span class=n>x</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=c1># TODO: Áp dụng activation function lên output từ convolution</span>
        <span class=k>return</span> <span class=n>x</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>DecoderBlock</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>in_channels</span><span class=p>,</span> <span class=n>middle_channels</span><span class=p>,</span> <span class=n>out_channels</span><span class=p>,</span> <span class=n>is_deconv</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
        <span class=nb>super</span><span class=p>(</span><span class=n>DecoderBlock</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
        <span class=c1># TODO: Lưu lại giá trị in_channels</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>in_channels</span> <span class=o>=</span> <span class=n>in_channels</span>

        <span class=c1># TODO: Nếu is_deconv là True, sử dụng ConvTranspose2d để tăng kích thước</span>
        <span class=k>if</span> <span class=n>is_deconv</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>block</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span>
                <span class=c1># TODO: Thêm một lớp ConvRelu với in_channels và middle_channels</span>
                <span class=n>ConvRelu</span><span class=p>(</span><span class=n>in_channels</span><span class=p>,</span> <span class=n>middle_channels</span><span class=p>),</span>

                <span class=c1># TODO: Thêm một lớp ConvTranspose2d với middle_channels và out_channels</span>
                <span class=n>nn</span><span class=o>.</span><span class=n>ConvTranspose2d</span><span class=p>(</span><span class=n>in_channels</span><span class=o>=</span><span class=n>middle_channels</span><span class=p>,</span> <span class=n>out_channels</span><span class=o>=</span><span class=n>out_channels</span><span class=p>,</span> <span class=n>kernel_size</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>stride</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>

                <span class=c1># TODO: Thêm một lớp ReLU activation với inplace=True</span>
                <span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(</span><span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
            <span class=p>)</span>
        <span class=c1># TODO: Nếu is_deconv là False, sử dụng Upsample để tăng kích thước</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>block</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span>
                <span class=c1># TODO: Thêm một lớp Upsample với scale_factor=2 và mode=&#39;bilinear&#39;</span>
                <span class=n>nn</span><span class=o>.</span><span class=n>Upsample</span><span class=p>(</span><span class=n>scale_factor</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;bilinear&#39;</span><span class=p>),</span>

                <span class=c1># TODO: Thêm một lớp ConvRelu với in_channels và middle_channels</span>
                <span class=n>ConvRelu</span><span class=p>(</span><span class=n>in_channels</span><span class=p>,</span> <span class=n>middle_channels</span><span class=p>),</span>

                <span class=c1># TODO: Thêm một lớp ConvRelu với middle_channels và out_channels</span>
                <span class=n>ConvRelu</span><span class=p>(</span><span class=n>middle_channels</span><span class=p>,</span> <span class=n>out_channels</span><span class=p>)</span>
            <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>block</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># TODO: Định nghĩa lớp UNet11 kế thừa từ nn.Module</span>
<span class=k>class</span><span class=w> </span><span class=nc>UNet11</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>num_classes</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>num_filters</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span> <span class=n>pretrained</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>is_deconv</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        :param num_classes: số lượng lớp đầu ra</span>
<span class=sd>        :param num_filters: số lượng bộ lọc sử dụng trong mạng</span>
<span class=sd>        :param pretrained: sử dụng mô hình VGG11 có trọng số pre-trained hay không</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>pool</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>MaxPool2d</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>

        <span class=c1># TODO: Lưu lại số lượng lớp đầu ra</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>num_classes</span> <span class=o>=</span> <span class=n>num_classes</span>

        <span class=c1># TODO: Kiểm tra nếu pretrained=True, sử dụng mô hình VGG11 với trọng số có sẵn</span>
        <span class=k>if</span> <span class=n>pretrained</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>vgg11</span><span class=p>(</span><span class=n>weights</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>vgg</span><span class=o>.</span><span class=n>VGG11_Weights</span><span class=o>.</span><span class=n>DEFAULT</span><span class=p>)</span><span class=o>.</span><span class=n>features</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>vgg11</span><span class=p>()</span><span class=o>.</span><span class=n>features</span>

        <span class=c1># TODO: Khởi tạo hàm kích hoạt ReLU</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>relu</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(</span><span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=c1># TODO: Xây dựng các khối convolutional từ các lớp trong VGG11</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>conv1</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span> <span class=c1># 3 to 64 channels</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
            <span class=c1># TODO: Thêm hàm kích hoạt ReLU</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>relu</span>
        <span class=p>)</span>   

        <span class=bp>self</span><span class=o>.</span><span class=n>conv2</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span> <span class=c1># 64 to 128 channels</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
            <span class=c1># TODO: Thêm hàm kích hoạt ReLU</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>relu</span>
        <span class=p>)</span>

        <span class=c1># TODO: Tiếp tục xây dựng các khối convolutional cho conv3, conv4, conv5</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>conv3</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span> <span class=c1># 128 to 256 channels</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span>
            <span class=c1># TODO: Thêm hàm kích hoạt ReLU</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>relu</span><span class=p>,</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span>
            <span class=c1># TODO: Thêm hàm kích hoạt ReLU</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>relu</span>
        <span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>conv4</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span> <span class=c1># 256 to 512 channels</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>relu</span><span class=p>,</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>relu</span>   
        <span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>conv5</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span> <span class=c1># 512 to 512 channels</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span><span class=p>[</span><span class=mi>16</span><span class=p>],</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>relu</span><span class=p>,</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>encoder</span><span class=p>[</span><span class=mi>18</span><span class=p>],</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>relu</span>
        <span class=p>)</span>


        <span class=c1># TODO: Xây dựng khối center và decoder tương ứng</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>center</span> <span class=o>=</span> <span class=n>DecoderBlock</span><span class=p>(</span><span class=mi>256</span> <span class=o>+</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span><span class=p>,</span> <span class=n>is_deconv</span><span class=o>=</span><span class=n>is_deconv</span><span class=p>)</span> <span class=c1># 256 + 256 -&gt; 256*2 -&gt; 256 channels</span>

        <span class=c1># TODO: Xây dựng các lớp decoder dec5, dec4, dec3, dec2, dec1 theo kiến trúc U-Net</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>dec5</span> <span class=o>=</span> <span class=n>DecoderBlock</span><span class=p>(</span><span class=mi>512</span> <span class=o>+</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>dec4</span> <span class=o>=</span> <span class=n>DecoderBlock</span><span class=p>(</span><span class=mi>512</span> <span class=o>+</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>dec3</span> <span class=o>=</span> <span class=n>DecoderBlock</span><span class=p>(</span><span class=mi>256</span> <span class=o>+</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>8</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>4</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>dec2</span> <span class=o>=</span> <span class=n>DecoderBlock</span><span class=p>(</span><span class=mi>128</span> <span class=o>+</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>4</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>dec1</span> <span class=o>=</span> <span class=n>DecoderBlock</span><span class=p>(</span><span class=mi>64</span> <span class=o>+</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span> <span class=n>num_filters</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span> <span class=n>num_filters</span><span class=p>)</span>
        <span class=c1># TODO: Xây dựng lớp final convolution</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>final</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=n>num_filters</span><span class=p>,</span> <span class=n>num_classes</span><span class=p>,</span> <span class=n>kernel_size</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
        <span class=c1># TODO: Thực hiện forward pass theo thứ tự các tầng conv1 -&gt; conv5, pool giữa các tầng</span>
        <span class=n>conv1</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conv1</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=c1># 64, 224x224</span>
        <span class=n>conv2</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conv2</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=p>(</span><span class=n>conv1</span><span class=p>))</span> <span class=c1># 128, 112x112</span>
        <span class=c1># TODO: Tiếp tục cho đến conv5</span>
        <span class=n>conv3</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conv3</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=p>(</span><span class=n>conv2</span><span class=p>))</span> <span class=c1># 256, 56x56</span>
        <span class=n>conv4</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conv4</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=p>(</span><span class=n>conv3</span><span class=p>))</span> <span class=c1># 512, 28x28</span>
        <span class=n>conv5</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conv5</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=p>(</span><span class=n>conv4</span><span class=p>))</span> <span class=c1># 512, 14x14</span>

        <span class=c1># TODO: Truyền qua tầng center</span>
        <span class=n>center</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>center</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=p>(</span><span class=n>conv5</span><span class=p>))</span> <span class=c1># 256, 7x7 -&gt; 14x14</span>

        <span class=c1># TODO: Ghép nối (concat) các đặc trưng từ encoder với decoder theo từng tầng</span>
        <span class=n>dec5</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dec5</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>cat</span><span class=p>([</span><span class=n>center</span><span class=p>,</span> <span class=n>conv5</span><span class=p>],</span> <span class=mi>1</span><span class=p>))</span> <span class=c1># 28x28</span>
        <span class=c1># TODO: Tiếp tục với dec4, dec3, dec2, dec1</span>
        <span class=n>dec4</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dec4</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>cat</span><span class=p>([</span><span class=n>dec5</span><span class=p>,</span> <span class=n>conv4</span><span class=p>],</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>))</span> <span class=c1># 56x56</span>
        <span class=n>dec3</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dec3</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>cat</span><span class=p>([</span><span class=n>dec4</span><span class=p>,</span> <span class=n>conv3</span><span class=p>],</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>))</span> <span class=c1># 112x112</span>
        <span class=n>dec2</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dec2</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>cat</span><span class=p>([</span><span class=n>dec3</span><span class=p>,</span> <span class=n>conv2</span><span class=p>],</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>))</span> <span class=c1># 244x244</span>
        <span class=n>dec1</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dec1</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>cat</span><span class=p>([</span><span class=n>dec2</span><span class=p>,</span> <span class=n>conv1</span><span class=p>],</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>))</span> <span class=c1># 448x448</span>

        <span class=c1># fix bug</span>
        <span class=n>dec1</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=p>(</span><span class=n>dec1</span><span class=p>)</span> <span class=c1># 244x244</span>

        <span class=c1># TODO: Kiểm tra nếu num_classes &gt; 1, sử dụng log_softmax, ngược lại sử dụng conv đầu ra</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_classes</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>x_out</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>log_softmax</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>final</span><span class=p>(</span><span class=n>dec1</span><span class=p>),</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>x_out</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>final</span><span class=p>(</span><span class=n>dec1</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>x_out</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Create the model</span>
<span class=kn>from</span><span class=w> </span><span class=nn>torchsummary</span><span class=w> </span><span class=kn>import</span> <span class=n>summary</span>

<span class=n>model</span> <span class=o>=</span> <span class=n>UNet11</span><span class=p>(</span><span class=n>pretrained</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=n>model</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
<span class=n>summary</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>224</span><span class=p>,</span> <span class=mi>224</span><span class=p>))</span>
</code></pre></div> <div class=highlight><pre><span></span><code>----------------------------------------------------------------
        Layer (type)               Output Shape         Param #
================================================================
            Conv2d-1         [-1, 64, 224, 224]           1,792
            Conv2d-2         [-1, 64, 224, 224]           1,792
              ReLU-3         [-1, 64, 224, 224]               0
              ReLU-4         [-1, 64, 224, 224]               0
              ReLU-5         [-1, 64, 224, 224]               0
              ReLU-6         [-1, 64, 224, 224]               0
              ReLU-7         [-1, 64, 224, 224]               0
              ReLU-8         [-1, 64, 224, 224]               0
         MaxPool2d-9         [-1, 64, 112, 112]               0
           Conv2d-10        [-1, 128, 112, 112]          73,856
           Conv2d-11        [-1, 128, 112, 112]          73,856
             ReLU-12        [-1, 128, 112, 112]               0
             ReLU-13        [-1, 128, 112, 112]               0
             ReLU-14        [-1, 128, 112, 112]               0
             ReLU-15        [-1, 128, 112, 112]               0
             ReLU-16        [-1, 128, 112, 112]               0
             ReLU-17        [-1, 128, 112, 112]               0
        MaxPool2d-18          [-1, 128, 56, 56]               0
           Conv2d-19          [-1, 256, 56, 56]         295,168
           Conv2d-20          [-1, 256, 56, 56]         295,168
             ReLU-21          [-1, 256, 56, 56]               0
             ReLU-22          [-1, 256, 56, 56]               0
             ReLU-23          [-1, 256, 56, 56]               0
             ReLU-24          [-1, 256, 56, 56]               0
             ReLU-25          [-1, 256, 56, 56]               0
             ReLU-26          [-1, 256, 56, 56]               0
           Conv2d-27          [-1, 256, 56, 56]         590,080
           Conv2d-28          [-1, 256, 56, 56]         590,080
             ReLU-29          [-1, 256, 56, 56]               0
             ReLU-30          [-1, 256, 56, 56]               0
             ReLU-31          [-1, 256, 56, 56]               0
             ReLU-32          [-1, 256, 56, 56]               0
             ReLU-33          [-1, 256, 56, 56]               0
             ReLU-34          [-1, 256, 56, 56]               0
        MaxPool2d-35          [-1, 256, 28, 28]               0
           Conv2d-36          [-1, 512, 28, 28]       1,180,160
           Conv2d-37          [-1, 512, 28, 28]       1,180,160
             ReLU-38          [-1, 512, 28, 28]               0
             ReLU-39          [-1, 512, 28, 28]               0
             ReLU-40          [-1, 512, 28, 28]               0
             ReLU-41          [-1, 512, 28, 28]               0
             ReLU-42          [-1, 512, 28, 28]               0
             ReLU-43          [-1, 512, 28, 28]               0
           Conv2d-44          [-1, 512, 28, 28]       2,359,808
           Conv2d-45          [-1, 512, 28, 28]       2,359,808
             ReLU-46          [-1, 512, 28, 28]               0
             ReLU-47          [-1, 512, 28, 28]               0
             ReLU-48          [-1, 512, 28, 28]               0
             ReLU-49          [-1, 512, 28, 28]               0
             ReLU-50          [-1, 512, 28, 28]               0
             ReLU-51          [-1, 512, 28, 28]               0
        MaxPool2d-52          [-1, 512, 14, 14]               0
           Conv2d-53          [-1, 512, 14, 14]       2,359,808
           Conv2d-54          [-1, 512, 14, 14]       2,359,808
             ReLU-55          [-1, 512, 14, 14]               0
             ReLU-56          [-1, 512, 14, 14]               0
             ReLU-57          [-1, 512, 14, 14]               0
             ReLU-58          [-1, 512, 14, 14]               0
             ReLU-59          [-1, 512, 14, 14]               0
             ReLU-60          [-1, 512, 14, 14]               0
           Conv2d-61          [-1, 512, 14, 14]       2,359,808
           Conv2d-62          [-1, 512, 14, 14]       2,359,808
             ReLU-63          [-1, 512, 14, 14]               0
             ReLU-64          [-1, 512, 14, 14]               0
             ReLU-65          [-1, 512, 14, 14]               0
             ReLU-66          [-1, 512, 14, 14]               0
             ReLU-67          [-1, 512, 14, 14]               0
             ReLU-68          [-1, 512, 14, 14]               0
        MaxPool2d-69            [-1, 512, 7, 7]               0
         Upsample-70          [-1, 512, 14, 14]               0
           Conv2d-71          [-1, 512, 14, 14]       2,359,808
      BatchNorm2d-72          [-1, 512, 14, 14]           1,024
             ReLU-73          [-1, 512, 14, 14]               0
         ConvRelu-74          [-1, 512, 14, 14]               0
           Conv2d-75          [-1, 256, 14, 14]       1,179,904
      BatchNorm2d-76          [-1, 256, 14, 14]             512
             ReLU-77          [-1, 256, 14, 14]               0
         ConvRelu-78          [-1, 256, 14, 14]               0
     DecoderBlock-79          [-1, 256, 14, 14]               0
           Conv2d-80          [-1, 512, 14, 14]       3,539,456
      BatchNorm2d-81          [-1, 512, 14, 14]           1,024
             ReLU-82          [-1, 512, 14, 14]               0
         ConvRelu-83          [-1, 512, 14, 14]               0
  ConvTranspose2d-84          [-1, 256, 28, 28]         524,544
             ReLU-85          [-1, 256, 28, 28]               0
     DecoderBlock-86          [-1, 256, 28, 28]               0
           Conv2d-87          [-1, 512, 28, 28]       3,539,456
      BatchNorm2d-88          [-1, 512, 28, 28]           1,024
             ReLU-89          [-1, 512, 28, 28]               0
         ConvRelu-90          [-1, 512, 28, 28]               0
  ConvTranspose2d-91          [-1, 256, 56, 56]         524,544
             ReLU-92          [-1, 256, 56, 56]               0
     DecoderBlock-93          [-1, 256, 56, 56]               0
           Conv2d-94          [-1, 256, 56, 56]       1,179,904
      BatchNorm2d-95          [-1, 256, 56, 56]             512
             ReLU-96          [-1, 256, 56, 56]               0
         ConvRelu-97          [-1, 256, 56, 56]               0
  ConvTranspose2d-98        [-1, 128, 112, 112]         131,200
             ReLU-99        [-1, 128, 112, 112]               0
    DecoderBlock-100        [-1, 128, 112, 112]               0
          Conv2d-101        [-1, 128, 112, 112]         295,040
     BatchNorm2d-102        [-1, 128, 112, 112]             256
            ReLU-103        [-1, 128, 112, 112]               0
        ConvRelu-104        [-1, 128, 112, 112]               0
 ConvTranspose2d-105         [-1, 64, 224, 224]          32,832
            ReLU-106         [-1, 64, 224, 224]               0
    DecoderBlock-107         [-1, 64, 224, 224]               0
          Conv2d-108         [-1, 64, 224, 224]          73,792
     BatchNorm2d-109         [-1, 64, 224, 224]             128
            ReLU-110         [-1, 64, 224, 224]               0
        ConvRelu-111         [-1, 64, 224, 224]               0
 ConvTranspose2d-112         [-1, 32, 448, 448]           8,224
            ReLU-113         [-1, 32, 448, 448]               0
    DecoderBlock-114         [-1, 32, 448, 448]               0
       MaxPool2d-115         [-1, 32, 224, 224]               0
          Conv2d-116          [-1, 1, 224, 224]              33
================================================================
Total params: 31,834,177
Trainable params: 31,834,177
Non-trainable params: 0
----------------------------------------------------------------
Input size (MB): 0.57
Forward/backward pass size (MB): 950.33
Params size (MB): 121.44
Estimated Total Size (MB): 1072.34
----------------------------------------------------------------
</code></pre></div> <h2 id=iou-metric>IOU metric</h2> <p>For quality assessment, we will use the IoU (intersection over union) metric defined as:</p> <p><span class=arithmatex>\(I o U=\frac{\text {target } \cap \text { prediction }}{\text {target } \cup{prediction }}\)</span></p> <h3 id=examples>Examples:</h3> <p><a class=glightbox href=https://www.jeremyjordan.me/content/images/2018/05/target_prediction.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt="alt text" src=https://www.jeremyjordan.me/content/images/2018/05/target_prediction.png></a></p> <h4 id=intersection-and-union>Intersection and union:</h4> <p><a class=glightbox href=https://www.jeremyjordan.me/content/images/2018/05/intersection_union.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt="alt text" src=https://www.jeremyjordan.me/content/images/2018/05/intersection_union.png></a></p> <h4 id=bai-tap-4-hoan-thanh-ham-iou-ben-duoi>Bài tập 4: Hoàn thành hàm IOU bên dưới</h4> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>iou_pytorch</span><span class=p>(</span><span class=n>outputs</span><span class=p>,</span> <span class=n>labels</span><span class=p>):</span>
    <span class=n>outputs</span> <span class=o>=</span> <span class=n>outputs</span><span class=o>.</span><span class=n>squeeze</span><span class=p>()</span><span class=o>.</span><span class=n>byte</span><span class=p>()</span>  <span class=c1># BATCH x 1 x H x W =&gt; BATCH x H x W</span>
    <span class=n>labels</span> <span class=o>=</span> <span class=n>labels</span><span class=o>.</span><span class=n>squeeze</span><span class=p>()</span><span class=o>.</span><span class=n>byte</span><span class=p>()</span>

    <span class=n>SMOOTH</span> <span class=o>=</span> <span class=mf>1e-8</span>

    <span class=c1># TODO: Tính toán phần giao nhau giữa outputs và labels</span>
    <span class=n>intersection</span> <span class=o>=</span> <span class=p>(</span><span class=n>outputs</span> <span class=o>&amp;</span> <span class=n>labels</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>dim</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>

    <span class=c1># TODO: Tính toán phần hợp giữa outputs và labels</span>
    <span class=n>union</span> <span class=o>=</span> <span class=p>(</span><span class=n>outputs</span> <span class=o>|</span> <span class=n>labels</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>dim</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>

    <span class=c1># TODO: Tính toán IoU theo công thức iou theo công thức (intersection + SMOOTH) / (union + SMOOTH)</span>
    <span class=n>iou</span> <span class=o>=</span> <span class=p>(</span><span class=n>intersection</span> <span class=o>+</span> <span class=n>SMOOTH</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>union</span> <span class=o>+</span> <span class=n>SMOOTH</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>iou</span>
</code></pre></div> <h2 id=loss-function>Loss function</h2> <p>To start the training of our model, we will implement a loss function:\ <strong>Binary cross-enthropy loss (BCE)</strong></p> <div class=arithmatex>\[\mathcal L_{BCE}(y, \hat y) = -\sum_i \left[y_i\log\sigma(\hat y_i) + (1-y_i)\log(1-\sigma(\hat y_i))\right].\]</div> <p>where <span class=arithmatex>\(y\)</span> is our target and <span class=arithmatex>\(\hat y\)</span> is an output of the model. <span class=arithmatex>\(\sigma\)</span> is a logistic function </p> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>torch.nn</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>nn</span>

<span class=n>nn</span><span class=o>.</span><span class=n>BCEWithLogitsLoss</span><span class=p>()</span>
</code></pre></div> <div class=highlight><pre><span></span><code>BCEWithLogitsLoss()
</code></pre></div> <h1 id=3-train>3. Train</h1> <div class=highlight><pre><span></span><code><span class=c1># Function to denormalize image</span>
<span class=k>def</span><span class=w> </span><span class=nf>de_normalize</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>mean</span><span class=o>=</span><span class=n>mean</span><span class=p>,</span> <span class=n>std</span><span class=o>=</span><span class=n>std</span><span class=p>):</span>
    <span class=n>result</span> <span class=o>=</span> <span class=n>img</span> <span class=o>*</span> <span class=n>std</span> <span class=o>+</span> <span class=n>mean</span>
    <span class=n>result</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>clip</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>result</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Function to display the result</span>
<span class=nd>@torch</span><span class=o>.</span><span class=n>inference_mode</span><span class=p>()</span>
<span class=k>def</span><span class=w> </span><span class=nf>display_prediction</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>image</span><span class=p>,</span> <span class=n>target</span><span class=p>):</span>
    <span class=n>model</span><span class=o>.</span><span class=n>eval</span><span class=p>()</span>
    <span class=n>img</span> <span class=o>=</span> <span class=n>image</span><span class=p>[</span><span class=kc>None</span><span class=p>,</span><span class=o>...</span><span class=p>]</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>model</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
    <span class=n>pred</span> <span class=o>=</span> <span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>sigmoid</span><span class=p>(</span><span class=n>output</span><span class=o>.</span><span class=n>squeeze</span><span class=p>())</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>)</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>


    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s1>&#39;off&#39;</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&quot;Input Image&quot;</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>de_normalize</span><span class=p>(</span><span class=n>image</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span><span class=o>.</span><span class=n>transpose</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>)))</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s1>&#39;off&#39;</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&quot;Prediction&quot;</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>pred</span><span class=o>.</span><span class=n>cpu</span><span class=p>()</span><span class=o>.</span><span class=n>squeeze</span><span class=p>(),</span> <span class=n>cmap</span><span class=o>=</span><span class=s1>&#39;gray&#39;</span><span class=p>)</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s1>&#39;off&#39;</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&quot;Ground Truth&quot;</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>target</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span><span class=o>.</span><span class=n>transpose</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>cmap</span><span class=o>=</span><span class=s1>&#39;gray&#39;</span><span class=p>)</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Choose one set of image, mask in train set to display</span>
<span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>train_dataset</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
<span class=n>display_image</span> <span class=o>=</span> <span class=n>train_dataset</span><span class=p>[</span><span class=n>idx</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
<span class=n>display_mask</span> <span class=o>=</span> <span class=n>train_dataset</span><span class=p>[</span><span class=n>idx</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Function to evaluate model</span>
<span class=k>def</span><span class=w> </span><span class=nf>evaluate</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>val_loader</span><span class=p>,</span> <span class=n>criterion</span><span class=p>):</span>
    <span class=n>model</span><span class=o>.</span><span class=n>eval</span><span class=p>()</span>
    <span class=n>val_loss</span> <span class=o>=</span> <span class=mf>0.0</span>
    <span class=n>val_IOU</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>with</span> <span class=n>torch</span><span class=o>.</span><span class=n>no_grad</span><span class=p>():</span>
        <span class=k>for</span> <span class=n>inputs</span><span class=p>,</span> <span class=n>labels</span> <span class=ow>in</span> <span class=n>val_loader</span><span class=p>:</span>
            <span class=n>inputs</span><span class=p>,</span> <span class=n>labels</span> <span class=o>=</span> <span class=n>inputs</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>),</span> <span class=n>labels</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>

            <span class=n>outputs</span> <span class=o>=</span> <span class=n>model</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
            <span class=n>loss</span> <span class=o>=</span> <span class=n>criterion</span><span class=p>(</span><span class=n>outputs</span><span class=p>,</span> <span class=n>labels</span><span class=p>)</span>
            <span class=n>val_loss</span> <span class=o>+=</span> <span class=n>loss</span><span class=o>.</span><span class=n>item</span><span class=p>()</span>

            <span class=n>total</span> <span class=o>+=</span> <span class=n>labels</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
            <span class=n>predict_labels</span> <span class=o>=</span> <span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>sigmoid</span><span class=p>(</span><span class=n>outputs</span><span class=o>.</span><span class=n>squeeze</span><span class=p>())</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>)</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
            <span class=n>val_IOU</span> <span class=o>+=</span> <span class=n>iou_pytorch</span><span class=p>(</span><span class=n>predict_labels</span><span class=p>,</span> <span class=n>labels</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>item</span><span class=p>()</span>

    <span class=n>val_loss</span> <span class=o>=</span> <span class=n>val_loss</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>val_loader</span><span class=p>)</span>
    <span class=n>val_IOU</span> <span class=o>=</span> <span class=n>val_IOU</span> <span class=o>/</span> <span class=n>total</span>
    <span class=k>return</span> <span class=n>val_loss</span><span class=p>,</span> <span class=n>val_IOU</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Function to train model</span>
<span class=k>def</span><span class=w> </span><span class=nf>train</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>train_loader</span><span class=p>,</span> <span class=n>val_loader</span><span class=p>,</span> <span class=n>criterion</span><span class=p>,</span> <span class=n>optimizer</span><span class=p>,</span> <span class=n>max_epoch</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span> <span class=n>output_path</span><span class=o>=</span><span class=s1>&#39;best_model.pt&#39;</span><span class=p>):</span>
    <span class=c1># save progress</span>
    <span class=n>train_losses</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>val_losses</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>train_IOUs</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>val_IOUs</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>best_IOU</span> <span class=o>=</span> <span class=mf>0.0</span>

    <span class=c1># Train</span>
    <span class=k>for</span> <span class=n>epoch</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_epoch</span><span class=p>):</span>
        <span class=n>model</span><span class=o>.</span><span class=n>train</span><span class=p>()</span>

        <span class=n>running_loss</span> <span class=o>=</span> <span class=mf>0.0</span>
        <span class=n>running_IOU</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>

        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>inputs</span><span class=p>,</span> <span class=n>labels</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>train_loader</span><span class=p>,</span> <span class=mi>0</span><span class=p>):</span>
            <span class=c1># Move inputs and labels to the device</span>
            <span class=n>inputs</span><span class=p>,</span> <span class=n>labels</span> <span class=o>=</span> <span class=n>inputs</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>),</span> <span class=n>labels</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span> 

            <span class=c1># Zero the parameter gradients</span>
            <span class=n>optimizer</span><span class=o>.</span><span class=n>zero_grad</span><span class=p>()</span>

            <span class=c1># Forward pass</span>
            <span class=n>outputs</span> <span class=o>=</span> <span class=n>model</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
            <span class=n>loss</span> <span class=o>=</span> <span class=n>criterion</span><span class=p>(</span><span class=n>outputs</span><span class=p>,</span> <span class=n>labels</span><span class=p>)</span>

            <span class=n>running_loss</span> <span class=o>+=</span> <span class=n>loss</span><span class=o>.</span><span class=n>item</span><span class=p>()</span>

            <span class=c1># Calculate IOU</span>
            <span class=n>total</span> <span class=o>+=</span> <span class=n>labels</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
            <span class=n>predict_labels</span> <span class=o>=</span> <span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>sigmoid</span><span class=p>(</span><span class=n>outputs</span><span class=o>.</span><span class=n>squeeze</span><span class=p>())</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>)</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>

            <span class=n>running_IOU</span> <span class=o>+=</span> <span class=n>iou_pytorch</span><span class=p>(</span><span class=n>predict_labels</span><span class=p>,</span> <span class=n>labels</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>item</span><span class=p>()</span>

            <span class=c1># Backward pass and optimization</span>
            <span class=n>loss</span><span class=o>.</span><span class=n>backward</span><span class=p>()</span>
            <span class=n>optimizer</span><span class=o>.</span><span class=n>step</span><span class=p>()</span>

        <span class=n>epoch_loss</span> <span class=o>=</span> <span class=n>running_loss</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>train_loader</span><span class=p>)</span>
        <span class=n>epoch_IOU</span> <span class=o>=</span> <span class=n>running_IOU</span> <span class=o>/</span> <span class=n>total</span>
        <span class=n>val_loss</span><span class=p>,</span> <span class=n>val_IOU</span> <span class=o>=</span> <span class=n>evaluate</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>val_loader</span><span class=p>,</span> <span class=n>criterion</span><span class=p>)</span>
        <span class=c1># Save best model</span>
        <span class=k>if</span> <span class=n>val_IOU</span> <span class=o>&gt;</span> <span class=n>best_IOU</span><span class=p>:</span>
            <span class=n>best_IOU</span> <span class=o>=</span> <span class=n>val_IOU</span>
            <span class=n>model_scripted</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>jit</span><span class=o>.</span><span class=n>script</span><span class=p>(</span><span class=n>model</span><span class=p>)</span> <span class=c1># Export to TorchScript</span>
            <span class=n>model_scripted</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>output_path</span><span class=p>)</span> <span class=c1># Save</span>

        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Epoch [</span><span class=si>{</span><span class=n>epoch</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>max_epoch</span><span class=si>}</span><span class=s2>], Loss: </span><span class=si>{</span><span class=n>epoch_loss</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>, IOU: </span><span class=si>{</span><span class=n>epoch_IOU</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>, Val Loss: </span><span class=si>{</span><span class=n>val_loss</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>, Val IOU: </span><span class=si>{</span><span class=n>val_IOU</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=n>display_prediction</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>display_image</span><span class=p>,</span> <span class=n>display_mask</span><span class=p>)</span>


        <span class=c1># Save for plot</span>
        <span class=n>train_losses</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>epoch_loss</span><span class=p>)</span>
        <span class=n>train_IOUs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>epoch_IOU</span><span class=p>)</span>
        <span class=n>val_losses</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>val_loss</span><span class=p>)</span>
        <span class=n>val_IOUs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>val_IOU</span><span class=p>)</span>

    <span class=k>return</span> <span class=p>[</span><span class=n>train_losses</span><span class=p>,</span> <span class=n>val_losses</span><span class=p>,</span> <span class=n>train_IOUs</span><span class=p>,</span> <span class=n>val_IOUs</span><span class=p>]</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Clear the GPU memory just in case</span>
<span class=kn>import</span><span class=w> </span><span class=nn>gc</span>
<span class=nb>print</span><span class=p>(</span><span class=n>gc</span><span class=o>.</span><span class=n>collect</span><span class=p>())</span>
<span class=nb>print</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>empty_cache</span><span class=p>())</span>
<span class=nb>print</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>memory_allocated</span><span class=p>())</span>
</code></pre></div> <div class=highlight><pre><span></span><code>2841
None
91528192
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Train the model</span>
<span class=n>max_epoch</span> <span class=o>=</span> <span class=mi>20</span>
<span class=n>lr</span> <span class=o>=</span> <span class=mf>4e-5</span>
<span class=n>weight_decay</span> <span class=o>=</span> <span class=mf>1e-4</span>
<span class=n>criterion</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>BCEWithLogitsLoss</span><span class=p>()</span>
<span class=n>optimizer</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>optim</span><span class=o>.</span><span class=n>AdamW</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>parameters</span><span class=p>(),</span> <span class=n>lr</span><span class=o>=</span><span class=n>lr</span><span class=p>,</span> <span class=n>weight_decay</span> <span class=o>=</span> <span class=n>weight_decay</span><span class=p>)</span>
<span class=n>history_bce</span> <span class=o>=</span> <span class=n>train</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>train_loader</span><span class=p>,</span> <span class=n>val_loader</span><span class=p>,</span> <span class=n>criterion</span><span class=p>,</span> <span class=n>optimizer</span><span class=p>,</span> <span class=n>max_epoch</span><span class=p>,</span> <span class=s1>&#39;best_unet11_model.pt&#39;</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>Epoch [1/20], Loss: 0.5455, IOU: 0.10, Val Loss: 0.4721, Val IOU: 0.34
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_1.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_1.png></a></p> <div class=highlight><pre><span></span><code>Epoch [2/20], Loss: 0.3968, IOU: 0.62, Val Loss: 0.3473, Val IOU: 0.64
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_3.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_3.png></a></p> <div class=highlight><pre><span></span><code>Epoch [3/20], Loss: 0.3020, IOU: 0.74, Val Loss: 0.2983, Val IOU: 0.68
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_5.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_5.png></a></p> <div class=highlight><pre><span></span><code>Epoch [4/20], Loss: 0.2391, IOU: 0.79, Val Loss: 0.2709, Val IOU: 0.62
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_7.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_7.png></a></p> <div class=highlight><pre><span></span><code>Epoch [5/20], Loss: 0.1968, IOU: 0.82, Val Loss: 0.2199, Val IOU: 0.72
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_9.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_9.png></a></p> <div class=highlight><pre><span></span><code>Epoch [6/20], Loss: 0.1656, IOU: 0.85, Val Loss: 0.2055, Val IOU: 0.71
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_11.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_11.png></a></p> <div class=highlight><pre><span></span><code>Epoch [7/20], Loss: 0.1429, IOU: 0.86, Val Loss: 0.1920, Val IOU: 0.71
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_13.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_13.png></a></p> <div class=highlight><pre><span></span><code>Epoch [8/20], Loss: 0.1200, IOU: 0.88, Val Loss: 0.1746, Val IOU: 0.73
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_15.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_15.png></a></p> <div class=highlight><pre><span></span><code>Epoch [9/20], Loss: 0.1042, IOU: 0.89, Val Loss: 0.1702, Val IOU: 0.73
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_17.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_17.png></a></p> <div class=highlight><pre><span></span><code>Epoch [10/20], Loss: 0.0903, IOU: 0.90, Val Loss: 0.1658, Val IOU: 0.74
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_19.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_19.png></a></p> <div class=highlight><pre><span></span><code>Epoch [11/20], Loss: 0.0777, IOU: 0.91, Val Loss: 0.1627, Val IOU: 0.74
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_21.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_21.png></a></p> <div class=highlight><pre><span></span><code>Epoch [12/20], Loss: 0.0690, IOU: 0.92, Val Loss: 0.1524, Val IOU: 0.75
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_23.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_23.png></a></p> <div class=highlight><pre><span></span><code>Epoch [13/20], Loss: 0.0609, IOU: 0.93, Val Loss: 0.1514, Val IOU: 0.75
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_25.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_25.png></a></p> <div class=highlight><pre><span></span><code>Epoch [14/20], Loss: 0.0537, IOU: 0.94, Val Loss: 0.1508, Val IOU: 0.75
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_27.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_27.png></a></p> <div class=highlight><pre><span></span><code>Epoch [15/20], Loss: 0.0475, IOU: 0.94, Val Loss: 0.1495, Val IOU: 0.76
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_29.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_29.png></a></p> <div class=highlight><pre><span></span><code>Epoch [16/20], Loss: 0.0431, IOU: 0.94, Val Loss: 0.1512, Val IOU: 0.75
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_31.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_31.png></a></p> <div class=highlight><pre><span></span><code>Epoch [17/20], Loss: 0.0396, IOU: 0.94, Val Loss: 0.1484, Val IOU: 0.76
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_33.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_33.png></a></p> <div class=highlight><pre><span></span><code>Epoch [18/20], Loss: 0.0373, IOU: 0.94, Val Loss: 0.1522, Val IOU: 0.75
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_35.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_35.png></a></p> <div class=highlight><pre><span></span><code>Epoch [19/20], Loss: 0.0348, IOU: 0.94, Val Loss: 0.1458, Val IOU: 0.76
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_37.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_37.png></a></p> <div class=highlight><pre><span></span><code>Epoch [20/20], Loss: 0.0320, IOU: 0.95, Val Loss: 0.1539, Val IOU: 0.74
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_44_39.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_44_39.png></a></p> <h3 id=plot-charts>Plot charts</h3> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
<span class=kn>import</span><span class=w> </span><span class=nn>matplotlib.pyplot</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>plt</span>

<span class=p>[</span><span class=n>train_losses</span><span class=p>,</span> <span class=n>val_losses</span><span class=p>,</span> <span class=n>train_IOUs</span><span class=p>,</span> <span class=n>val_IOUs</span><span class=p>]</span> <span class=o>=</span> <span class=n>history_bce</span>

<span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span>

<span class=c1># Xác định các epoch có xu hướng overfitting</span>
<span class=n>epochs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>train_losses</span><span class=p>))</span>

<span class=c1># Điều kiện: Train loss giảm nhưng Val loss tăng</span>
<span class=n>overfit_loss_epochs</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>train_losses</span><span class=p>))</span> 
                       <span class=k>if</span> <span class=n>train_losses</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>train_losses</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=ow>and</span> <span class=n>val_losses</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>val_losses</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]]</span>

<span class=c1># Điều kiện: Train IOU tăng nhưng Val IOU giảm</span>
<span class=n>overfit_iou_epochs</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>train_IOUs</span><span class=p>))</span> 
                      <span class=k>if</span> <span class=n>train_IOUs</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>train_IOUs</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=ow>and</span> <span class=n>val_IOUs</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>val_IOUs</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]]</span>

<span class=c1># Vẽ loss</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>train_losses</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;Training loss&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;blue&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>val_losses</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;Validation loss&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>overfit_loss_epochs</span><span class=p>,</span> <span class=p>[</span><span class=n>val_losses</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>overfit_loss_epochs</span><span class=p>],</span> 
                <span class=n>color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;Overfitting Point&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Epoch&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;Loss&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Loss for Training and Validation&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>

<span class=c1># Vẽ IOU</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>train_IOUs</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;Training IOU&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;blue&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>val_IOUs</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;Validation IOU&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>overfit_iou_epochs</span><span class=p>,</span> <span class=p>[</span><span class=n>val_IOUs</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>overfit_iou_epochs</span><span class=p>],</span> 
                <span class=n>color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;Overfitting Point&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Epoch&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;IOU&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;IOU for Training and Validation&#39;</span><span class=p>)</span>
<span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>

<span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</code></pre></div> <p><a class=glightbox href=../UNet_files/UNet_46_0.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=png src=../UNet_files/UNet_46_0.png></a></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.path", "navigation.indexes", "navigation.top", "navigation.tracking"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>